<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Multi Snake - Células Pretas com Comida</title>
<style>
  body {
    margin:0;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
    background:#000000;
    font-family: "Noto Sans JP", sans-serif;
  }
  canvas {
    display:block;
    background:#000000;
  }
</style>
</head>
<body>
<canvas id="gameCanvas" width="400" height="400"></canvas>
<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
const box = 20;
const cols = canvas.width / box;
const rows = canvas.height / box;

// Cobrinhas com ideogramas
let snakes = [
  { ideogram: "和", color: "#b22222", body:[{x:5,y:5}] },
  { ideogram: "平", color: "#228b22", body:[{x:15,y:5}] },
  { ideogram: "道", color: "#1e90ff", body:[{x:5,y:15}] },
  { ideogram: "心", color: "#ff8c00", body:[{x:15,y:15}] }
];

// Comida como ponto preto
let food = { x: Math.floor(Math.random()*cols), y: Math.floor(Math.random()*rows) };

// Desenha fundo preto
function drawBackground(){
  ctx.fillStyle="#000000";
  ctx.fillRect(0,0,canvas.width,canvas.height);
}

// Desenha comida com célula branca e ponto preto
function drawFood(){
  // célula branca
  ctx.fillStyle="#ffffff";
  ctx.fillRect(food.x*box, food.y*box, box, box);

  // ponto preto no centro
  const centerX = food.x*box + box/2;
  const centerY = food.y*box + box/2;
  const radius = box/4;
  ctx.fillStyle="black";
  ctx.beginPath();
  ctx.arc(centerX, centerY, radius, 0, 2*Math.PI);
  ctx.fill();
}

// Desenha cobrinhas com ideogramas
function drawSnakes(){
  ctx.textAlign="center";
  ctx.textBaseline="middle";
  ctx.font="16px Noto Sans JP";
  for(let s of snakes){
    for(let part of s.body){
      // célula branca
      ctx.fillStyle="#ffffff";
      ctx.fillRect(part.x*box, part.y*box, box, box);
      // ideograma
      ctx.fillStyle = s.color;
      ctx.fillText(s.ideogram, part.x*box + box/2, part.y*box + box/2);
    }
  }
}

// Colisão consigo mesma
function isSelfCollision(snake, x, y){
  return snake.body.some(p => p.x === x && p.y === y);
}

// Movimento IA simples
function moveSnake(snake){
  let head = snake.body[0];
  let dx=0, dy=0;

  if(food.x > head.x) dx=1;
  else if(food.x < head.x) dx=-1;
  else if(food.y > head.y) dy=1;
  else if(food.y < head.y) dy=-1;

  let nextX = head.x + dx;
  let nextY = head.y + dy;

  // Evita colisão consigo mesma
  if(nextX<0 || nextY<0 || nextX>=cols || nextY>=rows || isSelfCollision(snake, nextX, nextY)){
    const dirs = [{dx:0,dy:-1},{dx:0,dy:1},{dx:-1,dy:0},{dx:1,dy:0}];
    for(let d of dirs){
      let nx = head.x + d.dx;
      let ny = head.y + d.dy;
      if(nx>=0 && ny>=0 && nx<cols && ny<rows && !isSelfCollision(snake, nx, ny)){
        nextX = nx;
        nextY = ny;
        break;
      }
    }
  }

  snake.body.unshift({x:nextX, y:nextY});

  // Comer comida
  if(nextX===food.x && nextY===food.y){
    placeFood();
  } else {
    snake.body.pop();
  }
}

// Posiciona comida em célula livre
function placeFood(){
  food = { x: Math.floor(Math.random()*cols), y: Math.floor(Math.random()*rows) };
  while(snakes.some(s=>s.body.some(p=>p.x===food.x && p.y===food.y))){
    food = { x: Math.floor(Math.random()*cols), y: Math.floor(Math.random()*rows) };
  }
}

// Loop principal
function gameLoop(){
  drawBackground();
  drawFood();
  snakes.forEach(s=>moveSnake(s));
  drawSnakes();
}

setInterval(gameLoop,180);
</script>
</body>
</html>
